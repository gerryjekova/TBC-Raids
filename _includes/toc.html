<div class="toc-sidebar">
  <div class="toc-header">Contents</div>
  <nav id="toc"></nav>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const content = document.querySelector('.page, .post');
  const headings = content.querySelectorAll('h2, h3');
  const toc = document.getElementById('toc');
  
  if (headings.length > 3) {
    let tocHTML = '<ul>';
    headings.forEach((heading, index) => {
      const id = heading.id || `heading-${index}`;
      if (!heading.id) heading.id = id;
      
      const level = heading.tagName === 'H2' ? 'toc-h2' : 'toc-h3';
      tocHTML += `<li class="${level}"><a href="#${id}">${heading.textContent}</a></li>`;
    });
    tocHTML += '</ul>';
    toc.innerHTML = tocHTML;
    
    // Highlight active section
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const id = entry.target.id;
        const link = toc.querySelector(`a[href="#${id}"]`);
        if (link) {
          if (entry.isIntersecting) {
            toc.querySelectorAll('a').forEach(a => a.classList.remove('active'));
            link.classList.add('active');
          }
        }
      });
    }, { rootMargin: '-100px 0px -80% 0px' });
    
    headings.forEach(heading => observer.observe(heading));
  } else {
    document.querySelector('.toc-sidebar').style.display = 'none';
  }
});
</script>